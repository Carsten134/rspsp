---
title: "Simulations"
author: "Carsten Stahl"
date: "2025-11-18"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyMC)
library(rspsp)
```
# H0

## Bandwidth on Decision: $\varphi_n^*$
We want to inspect how the bandwidth affects the decision of the test:

```{r bandwidth-h0}
## Simulation-Config ################
MC_N <- 1000
# approximating for different bandwidths
bandwidth <- 1:25/50
param_list_null <- list(h=bandwidth)
# Lattice size
n <- 20

## Nulls ############################
band_null_ma <- function(h){
  x <- gridMA(n, n, MA_coef_all(.7))
  y <- gridMA(n, n, MA_coef_all(.7))
  
  res <- test.spectral(x, y, 200, .05, h1=h, h2=h)
  return(list(decision=res$decision))
}

band_null_ma_row <- function(h) {
  x <- gridMA(n, n, MA_coef_row(.7))
  y <- gridMA(n, n, MA_coef_row(.7))
  
  res <- test.spectral(x, y, 200, .05, h1=h, h2=h)
  return(list(decision=res$decision))
}

band_null_ar <- function(h){
  x <- gridAR(n, n, .8, .08, .1)
  y <- gridAR(n, n, .8, .08, .1)
  
  res <- test.spectral(x, y, 200, .05, h1=h, h2=h)
  return(list(decision=res$decision))
}

## Running MCs ####################################
mc_band_ma <- future_mc(band_null_ma,
                        param_list=param_list_null,
                        repetitions=MC_N)
mc_band_ma_row <- future_mc(band_null_ma,
                        param_list=param_list_null,
                        repetitions=MC_N)

mc_band_ar <- future_mc(band_null_ar,
                        param_list=param_list_null,
                        repetitions=MC_N)

```

Next we want to briefly simulate with the same behavior with correlation
```{r null-cor}
band_null_ma_corr <- function(h) {
  K0 <- MA_coef_all(.7)
  K0_off <- K0*.5
  sample <- mvgridMA(n,n, K0, K0, K0_off, K0_off, .3)
  
  x <- sample$X1
  y <- sample$X2
  
  res <- test.spectral(x, y, 200, .05, h1=h, h2=h)
  return(list(decision=res$decision))
}

mc_band_ma_corr <- future_mc(band_null_ma_corr,
                             param_list=param_list_null,
                             repetitions=1)

```


Storing results:
```{r storing-res-h0-eq}
write.csv(mc_band_ar$output,file=r"{D:\Daten\DataScienceMaster\Semester 4\Masterarbeit\plotting_simulation_results\sim_results\mc_band_ar.csv}")

write.csv(mc_band_ma$output,file=r"{D:\Daten\DataScienceMaster\Semester 4\Masterarbeit\plotting_simulation_results\sim_results\mc_band_ma.csv}")

write.csv(mc_band_ma_row$output,file=r"{D:\Daten\DataScienceMaster\Semester 4\Masterarbeit\plotting_simulation_results\sim_results\mc_band_ma_row.csv}")

write.csv(mc_band_ma_row$output,file=r"{D:\Daten\DataScienceMaster\Semester 4\Masterarbeit\plotting_simulation_results\sim_results\mc_band_ma_corr.csv}")
```

## Bandwidth on Decision: $\varphi_^{iso*}$
Same again with isotropy.
```{r h0_bandwidth_iso}
null_bandwidth_ma_iso <- function(h) {
  n <- 25
  x <- gridMA(n, n, MA_coef_all(.5))
  res <- test.spectral(x,NULL,200,.05, "isotropy", h, h)
  return(list(decision=res$decision))
}

null_bandwidth_ma_iso_mc <- future_mc(null_bandwidth_ma_iso,
                                      param_list=param_list_null,
                                      repetitions=MC_N)

```

Loading data into plotting project:
```{r}
write.csv(null_bandwidth_ma_iso_mc$output,file=r"{D:\Daten\DataScienceMaster\Semester 4\Masterarbeit\plotting_simulation_results\sim_results\power\mc_band_ma_iso.csv}")
```


# H1: Approximating Power

## Blur Alternative
This is a testrun for powerestimations using `tidyMC`.

```{r blur-alternative}
# Config for Alternative
MC_N <- 1
param_list_alt <- list(delta=1:7/10,
                   n=c(10, 15, 20, 25, 30))


blur_alt <- function(delta, n) {
  K0 <- MA_coef_all(.7)
  K1 <- MA_coef_all(delta, 7)
  K1[3:5, 3:5] <- K0
  
  x <- gridMA(n, n, K0)
  y <- gridMA(n, n, K1)
  
  res <- test.spectral(x, y, 200, .05)
  return(list(decision=res$decision))
}

mc_blur_alt <- future_mc(blur_alt,
                     MC_N,
                     param_list=param_list_alt)
# save result
write.csv(mc_blur_alt$output,r"{D:\Daten\DataScienceMaster\Semester 4\Masterarbeit\plotting_simulation_results\sim_results\power\mc_blur_alt.csv}")
```

## Rotation Alternative
```{r}
rot_alt <- function(delta, n) {
  x <- gridAR(n, n, .8, .05, .05)
  y <- gridAR(n, n, .8-delta, .05, .05 + delta)
  
  res <- test.spectral(x, y, 200, .05)
  return(list(decision=res$decision))
}

mc_rot_alt <- future_mc(blur_alt,
                     MC_N,
                     param_list=param_list_alt)

# save result
write.csv(mc_rot_alt$output,r"{D:\Daten\DataScienceMaster\Semester 4\Masterarbeit\plotting_simulation_results\sim_results\power\mc_rot_alt.csv}")
```

## Correlation Blur-Alternative
```{r}
blur_alt_corr <- function(delta, n) {
  K0 <- MA_coef_all(.7)
  K1 <- MA_coef_all(delta, 7)
  
  K1[3:5, 3:5] <- K0
  
  K0_off <- K0*.5
  K1_off <- K1*.5
  
  sample <- mvgridMA(n,n, K0, K1, K0_off, K1_off, .3)
  
  x <- sample$X1
  y <- sample$X2
  
  res <- test.spectral(x, y, 200, .05)
  return(list(decision=res$decision))
}

mc_blur_cor_alt <- future_mc(blur_alt,
                     MC_N,
                     param_list=param_list_alt)

# save result
write.csv(mc_blur_cor_alt$output,r"{D:\Daten\DataScienceMaster\Semester 4\Masterarbeit\plotting_simulation_results\sim_results\power\mc_blur_cor_alt.csv}")
```


## Isotropy

### Moving from Isotropic MA to non isotropic
```{r}
alt_iso_cross_to_row <- function(delta, n) {
  K1 <- matrix(0, ncol=3, nrow=3)
  K1[2,] = .7
  K1[,2] = .7-delta
  K1[2,2] = 1
  
  x <- gridMA(n, n, K1)
  res <- test.spectral(x, NULL, 200, .05, "isotropy")
  return(list(decision=res$decision))
}

mc_iso_alt <- future_mc(alt_iso_cross_to_row,
                        MC_N,
                        param_list=param_list_alt)

# save result
write.csv(mc_iso_alt$output,r"{D:\Daten\DataScienceMaster\Semester 4\Masterarbeit\plotting_simulation_results\sim_results\power\mc_iso_alt.csv}")
```


